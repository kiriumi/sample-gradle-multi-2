import java.time.format.DateTimeFormatter;

apply plugin: 'distribution'
//apply plugin: 'java-library-distribution'

ext {
     tmpDistsDirectory = buildDirectory.dir('tmpDistributions')
}

task preDist {

    doLast {

        if(!plugins.hasPlugin('war')) {
            // バッチプロジェクトのみ、依存ライブラリを取得する
            copy {
                from configurations.runtimeClasspath
                into libsDirectory.dir('dependencies')
            }
        }

        copy {
            from 'server-root'
            into tmpDistsDirectory
        }

        copy {
            from libsDirectory
            into file("${tmpDistsDirectory.get()}/lib")

       }
    }
}

distributions {

    main {

        def now = LocalDateTime.now();
        def formatter = DateTimeFormatter.ofPattern('yyyyMMddHHmmss')

        distributionBaseName = "dists-${formatter.format(now)}"

        contents {
            from tmpDistsDirectory
        }
    }
}

distZip.dependsOn preDist
