import java.time.format.DateTimeFormatter;

apply plugin: 'at.bxm.svntools'

allprojects {

    apply plugin: 'java'

    group = 'sample.gradle.multi'

    repositories {
        mavenCentral()
        maven { url "https://plugins.gradle.org/m2/" }
        maven { url "https://repository.primefaces.org/" }
        mavenLocal()
    }
}

subprojects {

    ext {
         serverDir = file('src/server')
         serverReleaseDir = file("${serverDir}/release")
    }

    sourceSets {
        server.resources {
            srcDirs = [ file("${serverReleaseDir}/conf") ]
        }
    }

    [compileJava, compileTestJava]*.options*.encoding = 'UTF-8'

    java {
        sourceCompatibility = JavaVersion.VERSION_14
        targetCompatibility = JavaVersion.VERSION_14
    }
}

wrapper {
    gradleVersion = '6.3'
}

def projectIfPresent(String projectPath) {

    if(findProject(projectPath)) {
        return project(projectPath)
    }

    def projectName = projectPath.substring(1)
    return "${group}:${projectName}:latest.integration"
}

task svnTag(type: at.bxm.gradleplugins.svntools.tasks.SvnTag) {

    def now = LocalDateTime.now();
    def formatter = DateTimeFormatter.ofPattern('yyyyMMddHHmmss')
    tagName = "${formatter.format(now)}_${deployProjectName}"

    commitMessage = "${project.name}-${formatter.format(now)}"
}
